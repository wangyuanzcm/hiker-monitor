{"code":"/**\r\n * 一款免费的开源性能监控SDK\r\n *\r\n * @remarks\r\n * 目前能够完成监控的指标包含FCP等\r\n *\r\n * @packageDocumentation\r\n */\r\nimport { config } from './config';\r\nimport { D, W, WN } from './data/constants';\r\nimport { logData } from './data/log';\r\nimport { getNavigationTiming } from './performance/getNavigationTiming';\r\nimport { disconnectPerfObserversHidden, initPerformanceObserver, } from './performance/observe';\r\nimport { isPerformanceSupported } from './tools/isSupported';\r\nimport ErrorTrace from './error';\r\nimport analyticsTracker from './data/analyticsTracker';\r\nimport ReportData from './data/reportData';\r\nimport { didVisibilityChange } from './helpers/onVisibilityChange';\r\nimport { getNetworkInformation } from './helpers/getNetworkInformation';\r\nimport { reportStorageEstimate } from './data/storageEstimate';\r\nexport default class Yideng {\r\n    constructor(options = {}) {\r\n        this.v = '1.0.0';\r\n        // 扩展基础配置\r\n        const logUrl = options.logUrl;\r\n        if (!logUrl) {\r\n            throw new Error(`京程一灯系统监控平台${this.v}提示未传递logUrl`);\r\n        }\r\n        //向后台输送数据\r\n        const insReportData = new ReportData({\r\n            logUrl,\r\n        });\r\n        config.reportData = insReportData;\r\n        //对外暴露上传接口\r\n        this.reportData = insReportData;\r\n        //集合数据汇总\r\n        const _analyticsTracker = options.analyticsTracker;\r\n        if (_analyticsTracker) {\r\n            config.analyticsTracker = _analyticsTracker;\r\n        }\r\n        else {\r\n            config.analyticsTracker = analyticsTracker;\r\n        }\r\n        config.isResourceTiming = !!options.resourceTiming;\r\n        config.isElementTiming = !!options.elementTiming;\r\n        config.maxTime = options.maxMeasureTime || config.maxTime;\r\n        if (options.captureError) {\r\n            //开启错误跟踪\r\n            const errorTtace = new ErrorTrace();\r\n            errorTtace.run();\r\n        }\r\n        //如果浏览器不支持性能指标只能放弃\r\n        if (!isPerformanceSupported()) {\r\n            return;\r\n        }\r\n        //浏览器支持的起FRP这样的Observer统计性能\r\n        if ('PerformanceObserver' in W) {\r\n            initPerformanceObserver();\r\n        }\r\n        //初始化\r\n        if (typeof D.hidden !== 'undefined') {\r\n            // Opera 12.10 and Firefox 18 and later support\r\n            D.addEventListener('visibilitychange', didVisibilityChange.bind(this, disconnectPerfObserversHidden));\r\n        }\r\n        //记录系统DNS请求+白屏时间等\r\n        logData('navigationTiming', getNavigationTiming());\r\n        //记录用户的网速 H5+多普勒测速\r\n        logData('networkInformation', getNetworkInformation());\r\n        //管理离线缓存数据\r\n        if (WN && WN.storage && typeof WN.storage.estimate === 'function') {\r\n            WN.storage.estimate().then(reportStorageEstimate);\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=index.js.map","references":["/Users/wangyuan/Desktop/hiker-monitor/src/config/index.ts","/Users/wangyuan/Desktop/hiker-monitor/src/data/constants.ts","/Users/wangyuan/Desktop/hiker-monitor/src/data/log.ts","/Users/wangyuan/Desktop/hiker-monitor/src/performance/getNavigationTiming.ts","/Users/wangyuan/Desktop/hiker-monitor/src/performance/observe.ts","/Users/wangyuan/Desktop/hiker-monitor/src/tools/isSupported.ts","/Users/wangyuan/Desktop/hiker-monitor/src/typings/types.ts","/Users/wangyuan/Desktop/hiker-monitor/src/error/index.ts","/Users/wangyuan/Desktop/hiker-monitor/src/data/analyticsTracker.ts","/Users/wangyuan/Desktop/hiker-monitor/src/data/reportData.ts","/Users/wangyuan/Desktop/hiker-monitor/src/helpers/onVisibilityChange.ts","/Users/wangyuan/Desktop/hiker-monitor/src/helpers/getNetworkInformation.ts","/Users/wangyuan/Desktop/hiker-monitor/src/data/storageEstimate.ts"],"map":"{\"version\":3,\"file\":\"index.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../src/index.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/wangyuan/Desktop/hiker-monitor/dist/index.d.ts","writeByteOrderMark":false,"text":"import { IYidengOptions } from './typings/types';\r\nexport default class Yideng {\r\n    private v;\r\n    private reportData;\r\n    constructor(options?: IYidengOptions);\r\n}\r\n"}}
