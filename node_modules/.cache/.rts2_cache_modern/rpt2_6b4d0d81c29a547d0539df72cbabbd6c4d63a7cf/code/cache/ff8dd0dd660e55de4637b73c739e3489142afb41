{"code":"import { AskPriority } from '../typings/types';\r\nimport { W, WN } from './constants';\r\nclass ReportData {\r\n    constructor(options) {\r\n        // console.log('⏰', options);\r\n        const { logUrl } = options;\r\n        if (logUrl) {\r\n            this.logUrl = logUrl;\r\n        }\r\n        else {\r\n            throw new Error('请传递要记录数据的路由~');\r\n        }\r\n    }\r\n    sendToAnalytics(level, body, uri) {\r\n        let logurl = this.logUrl;\r\n        //临时更换其他url\r\n        if (uri) {\r\n            logurl = uri;\r\n        }\r\n        // console.log('路由', logurl);\r\n        if (level == AskPriority.URGENT) {\r\n            if (!!W.fetch) {\r\n                fetch(logurl, { body, method: 'POST', keepalive: true });\r\n            }\r\n            else {\r\n                let xhr = new XMLHttpRequest();\r\n                xhr.open('post', logurl, true);\r\n                // 设置请求头\r\n                xhr.setRequestHeader('Content-Type', 'application/json');\r\n                xhr.send(body); // 发送参数\r\n                xhr.onload = function (e) {\r\n                    //   if (this.status == 200 || this.status == 304) {\r\n                    //     alert(this.responseText);\r\n                    //   }\r\n                    //及时清理以防多次创建\r\n                    xhr = null;\r\n                };\r\n            }\r\n        }\r\n        else if (level == AskPriority.IDLE) {\r\n            if (!!WN.sendBeacon) {\r\n                navigator.sendBeacon(logurl, body);\r\n            }\r\n            else {\r\n                let img = new Image();\r\n                img.src = `${logurl}?body=${body}`;\r\n                img.onload = function () {\r\n                    //统计完成收回创建的元素防止内存泄露\r\n                    img = null;\r\n                };\r\n            }\r\n        }\r\n    }\r\n}\r\nexport default ReportData;\r\n//# sourceMappingURL=ReportData.js.map","references":["/Users/wangyuan/Desktop/hiker-monitor/src/typings/types.ts","/Users/wangyuan/Desktop/hiker-monitor/src/data/constants.ts"],"map":"{\"version\":3,\"file\":\"ReportData.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/data/ReportData.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAE,WAAW,EAAe,MAAM,kBAAkB,CAAC;AAC5D,OAAO,EAAE,CAAC,EAAE,EAAE,EAAE,MAAM,aAAa,CAAC;AAMpC,MAAM,UAAU;IAEd,YAAY,OAAuB;QACjC,6BAA6B;QAC7B,MAAM,EAAE,MAAM,EAAE,GAAG,OAAO,CAAC;QAC3B,IAAI,MAAM,EAAE;YACV,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;SACtB;aAAM;YACL,MAAM,IAAI,KAAK,CAAC,cAAc,CAAC,CAAC;SACjC;IACH,CAAC;IACM,eAAe,CAAC,KAAkB,EAAE,IAAY,EAAE,GAAY;QACnE,IAAI,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;QACzB,WAAW;QACX,IAAI,GAAG,EAAE;YACP,MAAM,GAAG,GAAG,CAAC;SACd;QACD,6BAA6B;QAC7B,IAAI,KAAK,IAAI,WAAW,CAAC,MAAM,EAAE;YAC/B,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE;gBACb,KAAK,CAAC,MAAM,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;aAC1D;iBAAM;gBACL,IAAI,GAAG,GAA0B,IAAI,cAAc,EAAE,CAAC;gBACtD,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;gBAC/B,QAAQ;gBACR,GAAG,CAAC,gBAAgB,CAAC,cAAc,EAAE,kBAAkB,CAAC,CAAC;gBACzD,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO;gBACvB,GAAG,CAAC,MAAM,GAAG,UAAU,CAAC;oBACtB,oDAAoD;oBACpD,gCAAgC;oBAChC,MAAM;oBACN,YAAY;oBACZ,GAAG,GAAG,IAAI,CAAC;gBACb,CAAC,CAAC;aACH;SACF;aAAM,IAAI,KAAK,IAAI,WAAW,CAAC,IAAI,EAAE;YACpC,IAAI,CAAC,CAAC,EAAE,CAAC,UAAU,EAAE;gBACnB,SAAS,CAAC,UAAU,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;aACpC;iBAAM;gBACL,IAAI,GAAG,GAA4B,IAAI,KAAK,EAAE,CAAC;gBAC/C,GAAG,CAAC,GAAG,GAAG,GAAG,MAAM,SAAS,IAAI,EAAE,CAAC;gBACnC,GAAG,CAAC,MAAM,GAAG;oBACX,mBAAmB;oBACnB,GAAG,GAAG,IAAI,CAAC;gBACb,CAAC,CAAC;aACH;SACF;IACH,CAAC;CACF;AACD,eAAe,UAAU,CAAC\"}","dts":{"name":"/Users/wangyuan/Desktop/hiker-monitor/dist/data/ReportData.d.ts","writeByteOrderMark":false,"text":"import { AskPriority, IReportData } from '../typings/types';\r\ndeclare type TrackerOptions = {\r\n    logUrl: string;\r\n};\r\ndeclare class ReportData implements IReportData {\r\n    private logUrl;\r\n    constructor(options: TrackerOptions);\r\n    sendToAnalytics(level: AskPriority, body: string, uri?: string): void;\r\n}\r\nexport default ReportData;\r\n"}}
